<!-- layout/main.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/head :: head}"></head>
<body class="d-flex flex-column min-vh-100"> <!-- Flexbox for full height -->
<header th:replace="~{layout/navbar :: header}"></header>

<!-- Main content area takes up remaining space -->
<main class="container mt-4 flex-grow-1">
    <!--all content will be placed here-->

    <h3>Submit Death Case (সকল তথ্য দয়া করে ইংরেজীতে পূরণ করবেন)</h3>
    <p class="text-center text-danger">আপনাদের বুঝার সুবিধার্থে বাংলা ভাষাতেও লিখা হয়েছে, তবে তথ্যের পরিবেশেন ও কাজকে সহজ করতে সকল তথ্য ইংরেজীতে দেওয়ার জন্য অনুরোধ করছি। তবে চাইলে বাংলিশও লিখতে পারেন।</p>
    <!-- Bind the form to the 'victim' object -->
    <form action="/victims/submit-death-form" method="post" th:object="${victim}" enctype="multipart/form-data">
        <div class="alert alert-danger" th:if="${#fields.hasErrors('*')}">
            <ul>
                <li th:each="err : ${#fields.errors('*')}" th:text="${err}" class="text-danger"></li>
            </ul>
        </div>
        <!-- Hidden Field for Incident Type -->
        <input type="hidden" th:field="*{incidentType}" value="Death"/>
        <input type="hidden" th:field="*{deathDetails.deathCertificatePath}" value="uploads/death-certificates/">

        <!-- Full Name Field -->
        <div class="mb-3">
            <label for="fullName" class="form-label">Full Name (নিহত ব্যক্তির নাম) </label>
            <input type="text" class="form-control" id="fullName" th:field="*{fullName}" placeholder="ইংরেজীতে সম্পূর্ণ নাম লিখুন"
                   required>
            <div th:if="${#fields.hasErrors('fullName')}" class="text-danger">
                <p th:errors="*{fullName}"></p>
            </div>
        </div>

        <!-- Guardian's Name Field -->
        <div class="mb-3">
            <label for="guardianName" class="form-label">Guardian's Name (অভিভাবকের নাম)</label>
            <input type="text" class="form-control" id="guardianName" th:field="*{guardianName}" placeholder="অভিভাবকের নাম লিখুন" arequired>
            <div th:if="${#fields.hasErrors('guardianName')}" class="text-danger">
                <p th:errors="*{guardianName}"></p>
            </div>
        </div>

        <!-- Gender Field -->
        <div class="mb-3">
            <label for="gender" class="form-label">Gender(লিঙ্গ)</label>
            <select class="form-select" id="gender" th:field="*{gender}"  required>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>
            <div th:if="${#fields.hasErrors('gender')}" class="text-danger">
                <p th:errors="*{gender}"></p>
            </div>
        </div>

        <!-- Age Field -->
        <div class="mb-3">
            <label for="age" class="form-label">Age(বয়স)</label>
            <input type="number" class="form-control" id="age" th:field="*{age}" placeholder="নিহত ব্যক্তির বয়স কত?" required>
            <div th:if="${#fields.hasErrors('age')}" class="text-danger">
                <p th:errors="*{age}"></p>
            </div>
        </div>

        <!-- Contact Number Field -->
        <div class="mb-3">
            <label for="phoneNumber" class="form-label">Phone Number</label>
            <input type="text" class="form-control" id="phoneNumber" th:field="*{phoneNumber}" placeholder="নিহত ব্যক্তির বা তার পরিবারের ফোন নাম্বার" required>
            <div th:if="${#fields.hasErrors('phoneNumber')}" class="text-danger">
                <p th:errors="*{phoneNumber}"></p>
            </div>
        </div>

        <!-- Address Field -->
        <div class="mb-3">
            <label for="address" class="form-label">Address (ঠিকানা)</label>
            <input type="text" class="form-control" id="address" th:field="*{address}"  placeholder="নিহত ব্যক্তির বাসা/বাড়ী, এলাকা, রোড" required>
            <div th:if="${#fields.hasErrors('address')}" class="text-danger">
                <p th:errors="*{address}"></p>
            </div>

            <label for="policeStation" class="form-label">Police Station(নিহত ব্যক্তির থানা)</label>
            <input type="text" class="form-control" id="policeStation" th:field="*{policeStation}" placeholder="নিহত ব্যক্তি যেই থানার অধীনে বসবাস করতেন" required>
            <div th:if="${#fields.hasErrors('policeStation')}" class="text-danger">
                <p th:errors="*{policeStation}"></p>
            </div>
            <!-- District Field -->
            <div class="mb-3">
                <label for="district" class="form-label">Select District(বর্তমান জেলা)</label>
                <select class="form-select" id="district" th:field="*{district}">
                    <option value="">Select District</option>
                    <option value="Bagerhat">Bagerhat</option>
                    <option value="Bandarban">Bandarban</option>
                    <option value="Barguna">Barguna</option>
                    <option value="Barisal">Barisal</option>
                    <option value="Bhola">Bhola</option>
                    <option value="Bogra">Bogra</option>
                    <option value="Brahmanbaria">Brahmanbaria</option>
                    <option value="Chandpur">Chandpur</option>
                    <option value="Chittagong">Chittagong</option>
                    <option value="Chuadanga">Chuadanga</option>
                    <option value="Comilla">Comilla</option>
                    <option value="Cox's Bazar">Cox's Bazar</option>
                    <option value="Dhaka">Dhaka</option>
                    <option value="Dinajpur">Dinajpur</option>
                    <option value="Faridpur">Faridpur</option>
                    <option value="Feni">Feni</option>
                    <option value="Gaibandha">Gaibandha</option>
                    <option value="Gazipur">Gazipur</option>
                    <option value="Gopalganj">Gopalganj</option>
                    <option value="Habiganj">Habiganj</option>
                    <option value="Jamalpur">Jamalpur</option>
                    <option value="Jessore">Jessore</option>
                    <option value="Jhalokati">Jhalokati</option>
                    <option value="Jhenaidah">Jhenaidah</option>
                    <option value="Joypurhat">Joypurhat</option>
                    <option value="Khagrachari">Khagrachari</option>
                    <option value="Khulna">Khulna</option>
                    <option value="Kishoreganj">Kishoreganj</option>
                    <option value="Kurigram">Kurigram</option>
                    <option value="Kushtia">Kushtia</option>
                    <option value="Lakshmipur">Lakshmipur</option>
                    <option value="Lalmonirhat">Lalmonirhat</option>
                    <option value="Madaripur">Madaripur</option>
                    <option value="Magura">Magura</option>
                    <option value="Manikganj">Manikganj</option>
                    <option value="Maulvibazar">Maulvibazar</option>
                    <option value="Meherpur">Meherpur</option>
                    <option value="Munshiganj">Munshiganj</option>
                    <option value="Mymensingh">Mymensingh</option>
                    <option value="Naogaon">Naogaon</option>
                    <option value="Narail">Narail</option>
                    <option value="Narayanganj">Narayanganj</option>
                    <option value="Narsingdi">Narsingdi</option>
                    <option value="Natore">Natore</option>
                    <option value="Nawabganj">Nawabganj</option>
                    <option value="Netrokona">Netrokona</option>
                    <option value="Nilphamari">Nilphamari</option>
                    <option value="Noakhali">Noakhali</option>
                    <option value="Pabna">Pabna</option>
                    <option value="Panchagarh">Panchagarh</option>
                    <option value="Patuakhali">Patuakhali</option>
                    <option value="Pirojpur">Pirojpur</option>
                    <option value="Rajbari">Rajbari</option>
                    <option value="Rajshahi">Rajshahi</option>
                    <option value="Rangamati">Rangamati</option>
                    <option value="Rangpur">Rangpur</option>
                    <option value="Satkhira">Satkhira</option>
                    <option value="Shariatpur">Shariatpur</option>
                    <option value="Sherpur">Sherpur</option>
                    <option value="Sirajgonj">Sirajgonj</option>
                    <option value="Sunamganj">Sunamganj</option>
                    <option value="Sylhet">Sylhet</option>
                    <option value="Tangail">Tangail</option>
                    <option value="Thakurgaon">Thakurgaon</option>
                </select>
            </div>
        </div>


        <!-- National ID Field -->
        <div class="mb-3">
            <label for="nationalId" class="form-label">National ID / Birth Certificate NO (সঠিক নাম্বার প্রদান করুন)</label>
            <input type="text" class="form-control" id="nationalId" th:field="*{nationalId}" placeholder="নিহত ব্যক্তির জন্মসনদ বা জাতীয় পরিচয় পত্রের সঠিক নাম্বার দিন" required>
            <div th:if="${#fields.hasErrors('nationalId')}" class="text-danger">
                <p th:errors="*{nationalId}"></p>
            </div>
        </div>

        <!-- Incident Location Field -->
        <div class="mb-3">
            <label for="incidentLocation" class="form-label">Location of the Incident(ঘটনা ঘটার স্থান)</label>
            <input type="text" class="form-control" id="incidentLocation" th:field="*{incidentLocation}" placeholder="রোড, এলাকা, জেলা" required>
            <div th:if="${#fields.hasErrors('incidentLocation')}" class="text-danger">
                <p th:errors="*{incidentLocation}"></p>
            </div>
        </div>

        <!-- Incident Date Field -->
        <div class="mb-3">
            <label for="incidentDate" class="form-label">Incident Date(কত তারিখে?)</label>
            <input type="date" class="form-control" id="incidentDate" th:field="*{incidentDate}" placeholder="কত তারিখে ঘটনা ঘটেছিলেো?" required>
            <div th:if="${#fields.hasErrors('incidentDate')}" class="text-danger">
                <p th:errors="*{incidentDate}"></p>
            </div>
        </div>

        <!-- Incident Description Field -->
        <div class="mb-3">
            <label for="incidentDescription" class="form-label">Incident Description( সংক্ষেপে বর্ণনা করুন )</label>
            <textarea class="form-control" id="incidentDescription" th:field="*{incidentDescription}" placeholder="ঘটনার স্থানে কি হয়েছিলো? ইংরেজীতে লিখতে পারলে ভালো না হয়, বাংলিশে লিখুন সংক্ষিপ্ত করে"
                      required></textarea>
            <div th:if="${#fields.hasErrors('incidentDescription')}" class="text-danger">
                <p th:errors="*{incidentDescription}"></p>
            </div>
        </div>

        <!-- Additional Fields -->
        <!-- Email Field (Optional) -->
        <div class="mb-3">
            <label for="email" class="form-label">Email (required)</label>
            <input type="email" class="form-control" id="email" th:field="*{email}" placeholder="যোগাযোগের জন্য ইমেইল দিন" required>
            <div th:if="${#fields.hasErrors('email')}" class="text-danger">
                <p th:errors="*{email}"></p>
            </div>
        </div>

        <!-- Occupation Field (Optional) -->
        <div class="mb-3">
            <label for="occupation" class="form-label">Occupation (Required)(কী করেন?)</label>
            <input type="text" class="form-control" id="occupation" th:field="*{occupation}" placeholder="তিনি পেশায় কী ছিলেন? Student/Teacher/Driver/..?" required>
            <div th:if="${#fields.hasErrors('occupation')}" class="text-danger">
                <p th:errors="*{occupation}"></p>
            </div>
        </div>

        <!-- Participation Role Field -->
        <div class="mb-3">
            <label for="participationRole" class="form-label">Participation Role(ভূমিকা ছিলো: )</label>
            <select class="form-select" id="participationRole" th:field="*{participationRole}" required>
                <option value="">Select Role</option>
                <option value="Protester">Protester</option>
                <option value="Supporter">Supporter</option>
                <option value="Bystander">Bystander</option>
            </select>
        </div>

        <!-- Police Case Reference Field -->
        <div class="mb-3">
            <label for="policeCaseReference" class="form-label">Police Case Reference (Optional)</label>
            <input type="text" class="form-control" id="policeCaseReference" th:field="*{policeCaseReference}" placeholder="যদি কোর্ট/পুলিশের কোন রেফারেন্স থাকে">
        </div>

        <!--death fields-->
        <!-- Cause of Death -->
        <div class="mb-3">
            <label for="causeOfDeath" class="form-label">Cause of Death</label>
            <input type="text" id="causeOfDeath" name="causeOfDeath" class="form-control"
                   th:field="*{deathDetails.causeOfDeath}"  placeholder="মৃত্যুর কারণ লিখুন নির্দিষ্ট করে (গুলিতে, রাবার বুলেট, পিটিয়ে) অন্যান্য" required>
            <div class="text-danger" th:if="${#fields.hasErrors('deathDetails.causeOfDeath')}"
                 th:errors="*{deathDetails.causeOfDeath}"></div>
        </div>

        <!-- Date of Death -->
        <div class="mb-3">
            <label for="dateOfDeath" class="form-label">Date of Death</label>
            <input type="date" id="dateOfDeath" name="dateOfDeath" class="form-control"
                   th:field="*{deathDetails.dateOfDeath}" required>
            <div class="text-danger" th:if="${#fields.hasErrors('deathDetails.dateOfDeath')}"
                 th:errors="*{deathDetails.dateOfDeath}"></div>
        </div>

        <!-- Time of Death (Optional) -->
        <div class="mb-3">
            <label for="timeOfDeath" class="form-label">Time of Death (Optional)</label>
            <input type="time" id="timeOfDeath" name="timeOfDeath" class="form-control"
                   th:field="*{deathDetails.timeOfDeath}">
            <div class="text-danger" th:if="${#fields.hasErrors('deathDetails.timeOfDeath')}"
                 th:errors="*{deathDetails.timeOfDeath}"></div>
        </div>

        <!-- Burial or Cremation Details -->
        <div class="mb-3">
            <label for="burialCremationDetails" class="form-label">Burial/Cremation Details</label>
            <textarea id="burialCremationDetails" name="burialCremationDetails" class="form-control" rows="3"
                      th:field="*{deathDetails.burialCremationDetails}" placeholder="সমাধি/দাহ সংক্রান্ত বিবরণ লিখুন: কোথায় কবর/দাহ দিয়েছেন, জানাজা পড়ানো হয়েছে কিনা ইত্যাদি"
                      required></textarea>
            <div class="text-danger" th:if="${#fields.hasErrors('deathDetails.burialCremationDetails')}"
                 th:errors="*{deathDetails.burialCremationDetails}"></div>
        </div>

        <!-- Witness Account -->
        <div class="mb-3">
            <label for="witnessAccount" class="form-label">Witness Account</label>
            <textarea id="witnessAccount" name="witnessAccount" class="form-control" rows="3"
                      th:field="*{deathDetails.witnessAccount}" placeholder="সাক্ষীর বিবরণ লিখুন যেমনঃ নাম, ফোন, ঘটনার বিবরণ, তারিখ ইত্যাদি" required></textarea>
            <div class="text-danger" th:if="${#fields.hasErrors('deathDetails.witnessAccount')}"
                 th:errors="*{deathDetails.witnessAccount}"></div>
        </div>

        <!-- Autopsy Performed -->
        <div class="mb-3">
            <label class="form-label">Autopsy Performed (ময়নাতদন্ত হয়েছে)?</label>
            <div class="form-check">
                <input type="radio" id="autopsyYes" name="deathDetails.autopsyPerformed" value="true"
                       class="form-check-input" th:field="*{deathDetails.autopsyPerformed}">
                <label for="autopsyYes" class="form-check-label">Yes</label>
            </div>
            <div class="form-check">
                <input type="radio" id="autopsyNo" name="deathDetails.autopsyPerformed" value="false"
                       class="form-check-input" th:field="*{deathDetails.autopsyPerformed}" >
                <label for="autopsyNo" class="form-check-label">No</label>
            </div>
            <div class="text-danger" th:if="${#fields.hasErrors('deathDetails.autopsyPerformed')}"
                 th:errors="*{deathDetails.autopsyPerformed}"></div>
        </div>

        <!-- Death Photo Upload -->
        <div class="mb-3">
            <label for="deathPhoto" class="form-label">Death Persons Photo (Required) <a
                    th:href="@{/file-upload-instruction}">ছবি আপলোড করতে নির্দেশনা অনুসরণ করুন</a> </label>
            <input type="file" id="deathPhoto" name="deathDetails.deathPhotoFile" class="form-control"
                   th:field="*{deathDetails.deathPhotoFile}" accept=".jpg, .jpeg, .png">
            <div class="text-danger" th:if="${#fields.hasErrors('deathDetails.deathPhotoFile')}"
                 th:errors="*{deathDetails.deathPhotoFile}"></div>
        </div>

        <!-- Death Certificate Upload -->
        <div class="mb-3">
            <label for="deathCertificate" class="form-label">Death Certificate (Required) <a
                    th:href="@{/file-upload-instruction}">মৃত্যুসনদ ও অন্যান্য তথ্যের PDF আপলোড করতে নির্দেশনা অনুসরণ করুন</a> </label>
            <input type="file" id="deathCertificate" name="deathDetails.deathCertificateFile" class="form-control"
                   th:field="*{deathDetails.deathCertificateFile}" accept=".pdf">
            <div class="text-danger" th:if="${#fields.hasErrors('deathDetails.deathCertificateFile')}"
                 th:errors="*{deathDetails.deathCertificateFile}"></div>
        </div>

        <!-- Contact Person Information -->
        <h4>Contact Person Information</h4>
        <div class="mb-3">
            <label for="contactPersonName" class="form-label">Contact Person Name</label>
            <input type="text" class="form-control" id="contactPersonName" th:field="*{contactName}" placeholder="যার সাথে যোগাযোগ করা যেতে পারে তার নাম লিখুন" required>
            <div th:if="${#fields.hasErrors('contactName')}" class="text-danger">
                <p th:errors="*{contactName}">Contact person name is required</p>
            </div>
        </div>

        <div class="mb-3">
            <label for="contactPersonRelationship" class="form-label">Relationship to Victim</label>
            <input type="text" class="form-control" id="contactPersonRelationship" th:field="*{relationshipToVictim}" placeholder="মৃত ব্যক্তির সাথে সম্পর্ক কী ছিলো?"
                   required>
            <div th:if="${#fields.hasErrors('relationshipToVictim')}" class="text-danger">
                <p th:errors="*{relationshipToVictim}">Relationship to the victim is required</p>
            </div>
        </div>

        <div class="mb-3">
            <label for="contactPersonPhoneNumber" class="form-label">Contact Person Phone Number</label>
            <input type="text" class="form-control" id="contactPersonPhoneNumber" th:field="*{contactPhone}" placeholder="আপনার যোগাযোগের নাম্বার দিন" required>
            <div th:if="${#fields.hasErrors('contactPhone')}" class="text-danger">
                <p th:errors="*{contactPhone}">Phone number is required</p>
            </div>
        </div>

        <div class="mb-3">
            <label for="contactPersonAddress" class="form-label">Contact Person Address</label>
            <input type="text" class="form-control" id="contactPersonAddress" th:field="*{contactAddress}" placeholder="আপনার যোগাযোগের ঠিকানা" required>
            <div th:if="${#fields.hasErrors('contactAddress')}" class="text-danger">
                <p th:errors="*{contactAddress}">Phone number is required</p>
            </div>
        </div>

        <!-- Optional fields for Contact Person -->
        <div class="mb-3">
            <label for="contactEmail" class="form-label">Contact Person Email (Optional)</label>
            <input type="email" class="form-control" id="contactEmail" th:field="*{contactEmail}" placeholder="আপানার ইমেইল যদি থাকে">
        </div>

        <div class="mb-3">
            <label for="identificationDocument" class="form-label">Identification Document (Optional)</label>
            <input type="text" class="form-control" id="identificationDocument" placeholder="আপনার পরিচয়পত্র যদি থাকে"
                   th:field="*{contactIdentificationDocument}">
        </div>


        <button type="submit" class="btn btn-primary">Submit Death Case</button>
    </form>

</main>
<footer th:replace="~{layout/footer :: footer}"></footer>

<script>
    // Function to check file uploads before form submission
    document.querySelector("form").addEventListener("submit", function(event) {
        // Get the file inputs
        const deathPersonPhotoInput = document.getElementById("deathPhoto");
        const deathCertificateInput = document.getElementById("deathCertificate");

        // Reset previous error styles
        deathPersonPhotoInput.classList.remove("input-error");
        deathCertificateInput.classList.remove("input-error");

        // Check if the files are uploaded
        if (deathPersonPhotoInput.files.length === 0) {
            alert("Please upload the Died person's photo, it is required!");
            deathPersonPhotoInput.classList.add("input-error"); // Add red border
            deathPersonPhotoInput.scrollIntoView({ behavior: "smooth" }); // Scroll to the field
            event.preventDefault(); // Prevent form submission
            return; // Exit the function
        }

        if (deathCertificateInput.files.length === 0) {
            alert("Please upload the death certificate, it is required!");
            deathCertificateInput.classList.add("input-error"); // Add red border
            deathCertificateInput.scrollIntoView({ behavior: "smooth" }); // Scroll to the field
            event.preventDefault(); // Prevent form submission
            return; // Exit the function
        }

        // Check file sizes
        if (deathPersonPhotoInput.files[0].size / 1024 / 1024 > 1) {
            alert("Died person photo file size exceeds 1 MB\nPlease upload a photo less than 1MB in size.");
            deathPersonPhotoInput.classList.add("input-error"); // Add red border
            deathPersonPhotoInput.scrollIntoView({ behavior: "smooth" }); // Scroll to the field
            event.preventDefault(); // Prevent form submission
            return; // Exit the function
        }

        if (deathCertificateInput.files[0].size / 1024 / 1024 > 5) {
            alert("Death certificate file size exceeds 5 MB\nPlease upload a PDF less than 5MB in size.");
            deathCertificateInput.classList.add("input-error"); // Add red border
            deathCertificateInput.scrollIntoView({ behavior: "smooth" }); // Scroll to the field
            event.preventDefault(); // Prevent form submission
            return; // Exit the function
        }
    });

    // Separate validation when files are selected (optional, just to give immediate feedback)
    document.getElementById("deathPhoto").addEventListener("change", function() {
        this.classList.remove("input-error"); // Remove error style when a file is selected
        if (this.files[0].size / 1024 / 1024 > 1) {
            alert("Died person's photo file size exceeds 1 MB\nPlease upload a photo less than 1MB in size.");
            this.classList.add("input-error"); // Add red border
            this.value = ""; // Clear the input field
        }
    });

    document.getElementById("deathCertificate").addEventListener("change", function() {
        this.classList.remove("input-error"); // Remove error style when a file is selected
        if (this.files[0].size / 1024 / 1024 > 5) {
            alert("Death Certificate file size exceeds 5 MB\nPlease upload a PDF less than 5MB in size.");
            this.classList.add("input-error"); // Add red border
            this.value = ""; // Clear the input field
        }
    });
</script>

</body>
</html>
